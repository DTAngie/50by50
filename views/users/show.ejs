<%- include('../partials/header') %>
<%- include('../partials/nav') %>
<div class='container'>
    <div class="left">
        <div id="user-info">
            <h2><%= user.name%></h2>
            <p>
                <%= user.city ? user.city : '' %>
                <%= user.state ? user.state : '' %>
            </p>
            <% if(isOwner) {%>
                <span class="pseudo-link" id="change-location">Edit Location</span>
                <form class="collapsible" id="edit-location-form" action="/users/profile/<%= user._id %>?_method=PUT" method="POST">
                    <div>
                        <label for="user-city">City</label>
                        <input type="text" name="city" id="user-city">
                        <label for="user-state">State</label>
                        <select name="state" id="user-state">
                            <% states.forEach(function(s){ %>
                                <option value="<%= s %>"><%= s %></option>
                            <% }); %>
                        </select>
                        <button class="centered small" type="submit">Update</button>
                    </div>
                </form>
            <% }%>
        </div>
        <div id="race-info">
            <h3 class="inline-block"><%= isOwner ? 'My' : '' %> Races</h3>
            <% if(isOwner) {%>
                <a href="/races/new"><button>Add a Race</button></a>
            <% }%>
            <div id="races">
                <ul>
                    <% races.forEach(function(r){ %>
                        <li class=<%= (r._id.equals(currentRace && currentRace.id)) ? "current-race" : "" %>>
                            <a href="?currentRace=<%= r._id %>"><%= r.name %></a> 
                            <span>
                                <%= dateFormat(r.date, "mmm d, yyyy") %>
                            </span>
                        </li>
                    <% }); %>
                </ul>
            </div>
        </div>
    </div>
    <div class="right">
        <% if(currentRace) { %>
            <% if(isOwner) {%>
                <div class="delete-item" id="runner-<%= currentRace.runnerId %>-race-<%= currentRace._id %>"></div>
            <% } %>
            <h3><%= currentRace.name %> </h3>
            <p><%= currentRace.city %> <%= currentRace.state %></p>
            <div class="current-time">
                <p><span>Chip Time</span></p>
                <p class="inline-block"><%= currentRace.time %></p>
                <% if(isOwner) {%>
                    <p id="edit-time" class="pseudo-link inline-block">Edit</p>
                <% } %>
            </div>
            <form id="edit-time-form" class="collapsible" action="/races/<%= currentRace._id %>/runners/<%= currentRace.runnerId %>?_method=PUT" method="POST">
                <div>
                    <label for="hours">Hours</label>
                    <input type="number" name="hours" max="99" min="0" id="hours">
                    <label for="minutes">Minutes</label>
                    <input type="number" name="minutes" max="60" min="0" id="minutes">
                    <label for="seconds">Seconds</label>
                    <input type="number" name="seconds" max="60" min="0" id="seconds">
                    <button class="centered small" type="submit">Update</button>
                </div>
            </form>
            
            <a class="large-link" href="/races/<%= currentRace.id %>">View other Runners in this race</a>

            <% }  else { %>
            <p class="italic">Select a race to view details</p>
            <% } %>
            <p id="delete-account">Delete Account</p>
    </div>
</div>

<%- include('../partials/footer') %>